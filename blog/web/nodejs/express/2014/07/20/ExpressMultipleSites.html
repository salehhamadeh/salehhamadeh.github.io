<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <title>How to host multiple websites using Express.js</title>
        <meta name="description" content="Saleh Hamadeh's official blog. I write about technology, programming, hacks, and my personal life." />
        <meta name="author" content="Saleh Hamadeh" />
        <meta name="keywords" content="Saleh Hamadeh, Blog, Technology, Programming" />

        <meta name="viewport" content="width=device-width">

        <!-- RSS -->
        <link rel="alternate" type="application/rss+xml" title="Saleh Hamadeh's Blog" href="http://www.shamadeh.com/blog/feed.xml">

        <!-- jQuery (necessary for Bootstrap's JavaScript plugins and for endpage-box) -->
        <script src="https://code.jquery.com/jquery.js"></script>
        <!-- Twitter Bootstrap -->
        <link rel="stylesheet" href="/bootstrap/css/bootstrap.min.css">
        <!-- Font Awesome -->
        <link href="http://netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.css" rel="stylesheet">
        <!-- AddThis Smart Layers BEGIN -->
        <script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-51fee1032ce6a513"></script>
        <script type="text/javascript">
          addthis.layers({
            'theme' : 'transparent',
            'share' : {
              'position' : 'left',
              'numPreferredServices' : 5
            }   
          });
        </script>
        <!-- AddThis Smart Layers END -->
        

        <!-- syntax highlighting CSS -->
        <link rel="stylesheet" href="/stylesheets/syntax.css">

        <!-- Custom CSS -->
        <link rel="stylesheet" href="/stylesheets/style.css">

        <!-- Related article box code -->
        
          <link rel="stylesheet" href="/stylesheets/endpage-box.css">
          <script src="/js/jquery.endpage-box.min.js"></script>
          <script type="text/javascript">
            $(window).load( function() {
              $("#endpage-box").endpage_box({
                animation: "fade",
                from: "90%",
                to: "1000%",
              });
            });
          </script>
        
    </head>
    <body>
      <div id="wrap">
        <div class="navbar navbar-default navbar-static-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
    </div>
    <div class="navbar-collapse collapse" id="navbar-main">
      <ul class="nav navbar-nav">
        <li>
          <a href="/index.html">About Me</a>
        </li>
        <li>
          <a href="/projects.html">Projects</a>
        </li>
        <li class="active">
          <a href="/blog.html">Blog</a>
        </li>
      </ul>

      <ul class="nav navbar-nav navbar-right">
        <li><a href="https://www.facebook.com/salehhamadeh" target="_blank"><i class="fa fa-facebook fa-lg"></i><span class="sr-only">Facebook Profile</span></a></li>
        <li><a href="https://twitter.com/salehhamadeh" target="_blank"><i class="fa fa-twitter fa-lg"></i><span class="sr-only">Twitter Profile</span></a></li>
        <li><a href="https://github.com/salehhamadeh" target="_blank"><i class="fa fa-github fa-lg"></i><span class="sr-only">Github Profile</span></a></li>
        <li><a href="http://www.linkedin.com/pub/saleh-hamadeh/62/8b6/2a2" target="_blank"><i class="fa fa-linkedin fa-lg"></i><span class="sr-only">LinkedIn Profile</span></a></li>
      </ul>
    </div>
  </div>
</div>

        <div class="container">
          <div class="row">
            <h1>Saleh Hamadeh's Blog</h1>
            <div class="col-md-8 col-md-offset-1">
              <div class="post">
	<span class='date'>20 Jul 2014</span>
	<h1><a href=''>How to host multiple websites using Express.js</a></h1>
	<div class='body'><p>Hosting multiple websites using NodeJS and Express is made very simple using Express&#39;s <a href="https://github.com/expressjs/vhost">virtual hosts</a>. Using virtual hosts, you do not need to worry about using a reverse proxy to forward your visitors to different ports. Simply, a virtual host is an Express app tied to a domain name. What does that mean in code? Let&#39;s see!</p>

<h2>Our Workspace</h2>

<p>For demonstration, let us assume that we own two domain names: potato.com and tomato.com. We want www.potato.com to direct to the potato website, which is located in a directory named potato, and we want www.tomato.com to direct to the tomato website, which is located in a directory named tomato. For simplicity&#39;s sake, both websites are static websites.</p>

<h2>Creating a Virtual Host</h2>

<p>As I mentioned earlier, a virtual host is an Express app. This is not entirely true. A virtual host wraps up an application into a middleware. After it is wrapped up, we can use it in our main application. The code below shows how to create a virtual host (or vhost).</p>

<div class="highlight"><pre><code class="js"><span class="kd">function</span> <span class="nx">createVirtualHost</span><span class="p">(</span><span class="nx">domainName</span><span class="p">,</span> <span class="nx">dirPath</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">vhost</span> <span class="o">=</span> <span class="nx">express</span><span class="p">();</span>
    <span class="c1">//parses request body and populates request.body</span>
    <span class="nx">vhost</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span> <span class="nx">express</span><span class="p">.</span><span class="nx">bodyParser</span><span class="p">()</span> <span class="p">);</span>
    <span class="c1">//checks request.body for HTTP method overrides</span>
    <span class="nx">vhost</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span> <span class="nx">express</span><span class="p">.</span><span class="nx">methodOverride</span><span class="p">()</span> <span class="p">);</span>
    <span class="c1">//Where to serve static content</span>
    <span class="nx">vhost</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span> <span class="nx">express</span><span class="p">.</span><span class="kr">static</span><span class="p">(</span> <span class="nx">dirPath</span> <span class="p">)</span> <span class="p">);</span>
    <span class="c1">//Show errors</span>
    <span class="nx">vhost</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span> <span class="nx">express</span><span class="p">.</span><span class="nx">errorHandler</span><span class="p">({</span> <span class="nx">dumpExceptions</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span> <span class="nx">showStack</span><span class="o">:</span> <span class="kc">true</span> <span class="p">}));</span>

    <span class="k">return</span> <span class="nx">express</span><span class="p">.</span><span class="nx">vhost</span><span class="p">(</span><span class="nx">domainName</span><span class="p">,</span> <span class="nx">vhost</span><span class="p">)</span>
<span class="p">}</span></code></pre></div>

<p>For our potato and tomato app, we will need to create two virtual hosts as follows:</p>

<div class="highlight"><pre><code class="js"><span class="kd">var</span> <span class="nx">potatoHost</span> <span class="o">=</span> <span class="nx">createVirtualHost</span><span class="p">(</span><span class="s2">&quot;www.potato.com&quot;</span><span class="p">,</span> <span class="s2">&quot;potato&quot;</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">tomatoHost</span> <span class="o">=</span> <span class="nx">createVirtualHost</span><span class="p">(</span><span class="s2">&quot;www.tomato.com&quot;</span><span class="p">,</span> <span class="s2">&quot;tomato&quot;</span><span class="p">);</span></code></pre></div>

<h2>Using the Virtual Hosts</h2>

<p>Using the virtual hosts is as simple as using any piece of middleware. All we have to do is pass them to app.use:</p>

<div class="highlight"><pre><code class="js"><span class="kd">var</span> <span class="nx">app</span> <span class="o">=</span> <span class="nx">express</span><span class="p">();</span>
<span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">potatoHost</span><span class="p">);</span>
<span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">tomatoHost</span><span class="p">);</span></code></pre></div>

<h2>The Full Server Code</h2>

<div class="highlight"><pre><code class="js"><span class="c1">// Module dependencies.</span>
<span class="kd">var</span> <span class="nx">application_root</span> <span class="o">=</span> <span class="nx">__dirname</span><span class="p">,</span>
    <span class="nx">express</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span> <span class="s1">&#39;express&#39;</span> <span class="p">);</span>

<span class="kd">function</span> <span class="nx">createVirtualHost</span><span class="p">(</span><span class="nx">domainName</span><span class="p">,</span> <span class="nx">dirPath</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">vhost</span> <span class="o">=</span> <span class="nx">express</span><span class="p">();</span>
    <span class="c1">//parses request body and populates request.body</span>
    <span class="nx">vhost</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span> <span class="nx">express</span><span class="p">.</span><span class="nx">bodyParser</span><span class="p">()</span> <span class="p">);</span>
    <span class="c1">//checks request.body for HTTP method overrides</span>
    <span class="nx">vhost</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span> <span class="nx">express</span><span class="p">.</span><span class="nx">methodOverride</span><span class="p">()</span> <span class="p">);</span>
    <span class="c1">//Where to serve static content</span>
    <span class="nx">vhost</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span> <span class="nx">express</span><span class="p">.</span><span class="kr">static</span><span class="p">(</span> <span class="nx">dirPath</span> <span class="p">)</span> <span class="p">);</span>
    <span class="c1">//Show errors</span>
    <span class="nx">vhost</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span> <span class="nx">express</span><span class="p">.</span><span class="nx">errorHandler</span><span class="p">({</span> <span class="nx">dumpExceptions</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span> <span class="nx">showStack</span><span class="o">:</span> <span class="kc">true</span> <span class="p">}));</span>

    <span class="k">return</span> <span class="nx">express</span><span class="p">.</span><span class="nx">vhost</span><span class="p">(</span><span class="nx">domainName</span><span class="p">,</span> <span class="nx">vhost</span><span class="p">)</span>
<span class="p">}</span>

<span class="c1">//Create server</span>
<span class="kd">var</span> <span class="nx">app</span> <span class="o">=</span> <span class="nx">express</span><span class="p">();</span>

<span class="c1">//Create the virtual hosts</span>
<span class="kd">var</span> <span class="nx">potatoHost</span> <span class="o">=</span> <span class="nx">createVirtualHost</span><span class="p">(</span><span class="s2">&quot;www.potato.com&quot;</span><span class="p">,</span> <span class="s2">&quot;potato&quot;</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">tomatoHost</span> <span class="o">=</span> <span class="nx">createVirtualHost</span><span class="p">(</span><span class="s2">&quot;www.tomato.com&quot;</span><span class="p">,</span> <span class="s2">&quot;tomato&quot;</span><span class="p">);</span>

<span class="c1">//Use the virtual hosts</span>
<span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">potatoHost</span><span class="p">);</span>
<span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">tomatoHost</span><span class="p">);</span>

<span class="c1">//Start server</span>
<span class="kd">var</span> <span class="nx">port</span> <span class="o">=</span> <span class="mi">80</span><span class="p">;</span>
<span class="nx">app</span><span class="p">.</span><span class="nx">listen</span><span class="p">(</span> <span class="nx">port</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span> <span class="s1">&#39;Express server listening on port %d in %s mode&#39;</span><span class="p">,</span> <span class="nx">port</span><span class="p">,</span> <span class="nx">app</span><span class="p">.</span><span class="nx">settings</span><span class="p">.</span><span class="nx">env</span> <span class="p">);</span>
<span class="p">});</span></code></pre></div>

<h2>Testing the Server</h2>

<p>In order to see the server work, we must own both domain names and set their addresses to that of our server. Since we do not own the domain names and the process is arduous, we will modify the hosts file to make those domain names point to our local machine.</p>

<p>On Windows, the hosts file can be found in c:\windows\system32\drivers\etc</p>

<p>On Mac or Linux, the hosts file can be found in /etc</p>

<p>The hosts file may be hidden on some systems. If you do not see it in the directory, make sure that you enable viewing hidden files from your folder options or control panel.</p>

<p>Open the hosts file, add the following lines of code to the bottom of the file, and save it.</p>

<div class="highlight"><pre><code class="sh">127.0.0.1 www.potato.com
127.0.0.1 www.tomato.com</code></pre></div>

<p>Now, run your NodeJS application and navigate to www.potato.com and www.tomato.com from any browser. Voila! You should now be directed to the potato website and the tomato website respectively. Give yourself a pat on the back and have some chicken alfredo with a potato and a tomato on the side.</p>
</div>
	
    	<div id="disqus_thread"></div>
<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
    var disqus_shortname = 'shamadeh'; // required: replace example with your forum shortname

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
  	
</div>


            </div>
            
          </div>
          
            <div id="endpage-box" class="endpage-box"></div>
            <script>
              var related_posts = [{}
                
                  , {
                    title: "How to Verify Phone Numbers Using Twilio and Parse",
                    date: "31 Jul 2014",
                    url: "/blog/web/mobile/twilio/parse/2014/07/31/VerifyPhoneNumbersTwilioAndParse.html"
                  }
                
                  , {
                    title: "How to build a scalable REST API using Node.JS and Express",
                    date: "26 Jun 2014",
                    url: "/blog/web/2014/06/26/NodeRestAPITutorial.html"
                  }
                
                  , {
                    title: "My Internship at BrainJocks",
                    date: "28 May 2014",
                    url: "/blog/life/2014/05/28/InterningAtBrainJocks.html"
                  }
                
                  , {
                    title: "Web Security: Unvalidated Redirects",
                    date: "06 Apr 2014",
                    url: "/blog/web/2014/04/06/Unvalidated-Redirects.html"
                  }
                
                  , {
                    title: "Assess your Collaborative Programming Skills",
                    date: "16 Mar 2014",
                    url: "/blog/programming/2014/03/16/AssessYourCollaborativeProgramming.html"
                  }
                
                  , {
                    title: "Web Performance Trends: One Load, That's All",
                    date: "24 Feb 2014",
                    url: "/blog/web/2014/02/24/WebPerformanceTrends.html"
                  }
                
                  , {
                    title: "Why You should have a Virtual Machine in the Cloud",
                    date: "09 Feb 2014",
                    url: "/blog/opinion/2014/02/09/WhyYouShouldHaveACloudVM.html"
                  }
                
                  , {
                    title: "Computer Science VS Software Engineering",
                    date: "12 Jan 2014",
                    url: "/blog/opinion/2014/01/12/CompScieOrSoftEngineer.html"
                  }
                
                  , {
                    title: "Make a Blog Social (Without a Database)",
                    date: "28 Dec 2013",
                    url: "/blog/web/2013/12/28/MakeABlogSocial.html"
                  }
                
                  , {
                    title: "What if Cars had APIs",
                    date: "26 Dec 2013",
                    url: "/blog/sci-fi/2013/12/26/WhatIfCarsHadAPIs.html"
                  }
                
              ];  //The first blank element is a hack to fix liquid's for loop comma problem

              var post_index = function (min, max) {
                  return Math.floor(Math.random() * (max - min + 1)) + min;
              }(1, related_posts.length); //Get a random integer between 1 and related_posts.length
              $("#endpage-box").html('Related Post<br /><a href="' + related_posts[post_index].url + '">' + related_posts[post_index].title + '</a>');
            </script>
          
        </div>

        <div id="footer">
  <div class="container">
    <p class="text-center">Proudly hosted by Github Pages</p>
  </div>
</div>

        <script src="/bootstrap/js/bootstrap.min.js"></script>

        

        <script type="text/javascript">
          var _gaq = _gaq || [];
          _gaq.push(['_setAccount', 'UA-46641204-1']);
          _gaq.push(['_trackPageview']);

          (function() {
            var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
            ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
            var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
          })();
        </script>
      </div>
    </body>
</html>
