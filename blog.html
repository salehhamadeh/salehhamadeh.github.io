<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <title>Saleh Hamadeh's Blog</title>
        <meta name="description" content="Saleh Hamadeh's official blog. I write about technology, programming, hacks, and my personal life." />
        <meta name="author" content="Saleh Hamadeh" />
        <meta name="keywords" content="Saleh Hamadeh, Blog, Technology, Programming" />

        <meta name="viewport" content="width=device-width">

        <!-- RSS -->
        <link rel="alternate" type="application/rss+xml" title="Saleh Hamadeh's Blog" href="http://www.shamadeh.com/blog/feed.xml">

        <!-- jQuery (necessary for Bootstrap's JavaScript plugins and for endpage-box) -->
        <script src="https://code.jquery.com/jquery.js"></script>
        <!-- Twitter Bootstrap -->
        <link rel="stylesheet" href="/bootstrap/css/bootstrap.min.css">
        <!-- Font Awesome -->
        <link href="http://netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.css" rel="stylesheet">
        <!-- AddThis Smart Layers BEGIN -->
        <script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-51fee1032ce6a513"></script>
        <script type="text/javascript">
          addthis.layers({
            'theme' : 'transparent',
            'share' : {
              'position' : 'left',
              'numPreferredServices' : 5
            }   
          });
        </script>
        <!-- AddThis Smart Layers END -->
        
          <!-- Mailchimp Styles -->
          <link href="//cdn-images.mailchimp.com/embedcode/classic-081711.css" rel="stylesheet" type="text/css">
          <style type="text/css">
            #mc_embed_signup{background:#fff; clear:left; font:14px Helvetica,Arial,sans-serif; }
          </style>
        

        <!-- syntax highlighting CSS -->
        <link rel="stylesheet" href="/stylesheets/syntax.css">

        <!-- Custom CSS -->
        <link rel="stylesheet" href="/stylesheets/style.css">

        <!-- Related article box code -->
        
    </head>
    <body>
      <div id="wrap">
        <div class="navbar navbar-default navbar-static-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
    </div>
    <div class="navbar-collapse collapse" id="navbar-main">
      <ul class="nav navbar-nav">
        <li>
          <a href="/index.html">About Me</a>
        </li>
        <li>
          <a href="/projects.html">Projects</a>
        </li>
        <li class="active">
          <a href="/blog.html">Blog</a>
        </li>
      </ul>

      <ul class="nav navbar-nav navbar-right">
        <li><a href="https://www.facebook.com/salehhamadeh" target="_blank"><i class="fa fa-facebook fa-lg"></i><span class="sr-only">Facebook Profile</span></a></li>
        <li><a href="https://twitter.com/salehhamadeh" target="_blank"><i class="fa fa-twitter fa-lg"></i><span class="sr-only">Twitter Profile</span></a></li>
        <li><a href="https://github.com/salehhamadeh" target="_blank"><i class="fa fa-github fa-lg"></i><span class="sr-only">Github Profile</span></a></li>
        <li><a href="http://www.linkedin.com/pub/saleh-hamadeh/62/8b6/2a2" target="_blank"><i class="fa fa-linkedin fa-lg"></i><span class="sr-only">LinkedIn Profile</span></a></li>
      </ul>
    </div>
  </div>
</div>

        <div class="container">
          <div class="row">
            <h1>Saleh Hamadeh's Blog</h1>
            <div class="col-md-8 col-md-offset-1">
              
  
  <div class='post'>
    <span class='date'>31 Jul 2014</span>
    <h1><a href='/blog/web/mobile/twilio/parse/2014/07/31/VerifyPhoneNumbersTwilioAndParse.html'>How to verify phone numbers using Twilio and Parse</a></h1>
    <div class='body'><p>Do you want to create an app that relies on a user&#39;s phone number to function? If so, you have probably heard about <a href="https://www.twilio.com/">Twilio</a>. Twilio provides an API for developers to send and receive text messages as well as calls. On the other hand, <a href="https://parse.com/">Parse</a> has gained much popularity as a mobile app backend. Using Twilio along with Parse, you can verify your users&#39; phone numbers and store them in a database using fewer than 35 lines of server-side code. Sounds too good to be true, doesn&#39;t it? Let&#39;s get started.</p>

<h2>Parse Cloud Functions</h2>

<p>We need to store the code that communicates with Twilio somewhere on the server. This code is placed in what Parse calls <a href="https://www.parse.com/docs/cloud_code_guide">Cloud Functions</a>. Simply, Cloud Functions are functions that run on the server. However, they are triggered by the clients, which makes them act as API endpoints. For our purposes, we need to define two Cloud Functions: one to send the verification code to the user and one to verify the user&#39;s number.</p>

<h2>Creating Your First Cloud Function</h2>

<p>To start developing Cloud Functions, you must first have Parse&#39;s Command Line Tool installed on your machine. Since Parse did a great job in explaining this process, I will not repeat it here. If you have never written a Cloud Function before, please follow the Getting Started section of the <a href="https://parse.com/docs/cloud_code_guide">Parse Cloud Code Guide</a>.</p>

<h2>Send Verification Code</h2>

<p>The first Cloud Function that we need to write is the one that send the verification code to the user&#39;s phone. Luckily, Parse comes with bundled with a <a href="https://www.parse.com/docs/cloud_modules_guide#twilio">Twilio Cloud Module</a>. In other words, you do not need to install a Twilio client for your Parse function. All you need to do is import it. To import it, put the following line at the top of your main.js file, replacing <Your Twilio Account Sid> and <Your Twilio Auth Token> with their respective values from your Twilio dashboard.</p>

<div class="highlight"><pre><code class="js"><span class="kd">var</span> <span class="nx">twilio</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;twilio&#39;</span><span class="p">)(</span><span class="s1">&#39;&lt;Your Twilio Account Sid&gt;&#39;</span><span class="p">,</span> <span class="s1">&#39;&lt;Your Twilio Auth Token&gt;&#39;</span><span class="p">);</span></code></pre></div>

<p>Now, you have all you need to define your verfication code cloud function. I will call this function sendVerificationCode, but you can have any name that you like. The function is defined as follows:</p>

<div class="highlight"><pre><code class="js"><span class="nx">Parse</span><span class="p">.</span><span class="nx">Cloud</span><span class="p">.</span><span class="nx">define</span><span class="p">(</span><span class="s2">&quot;sendVerificationCode&quot;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">request</span><span class="p">,</span> <span class="nx">response</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">verificationCode</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span><span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">random</span><span class="p">()</span><span class="o">*</span><span class="mi">999999</span><span class="p">);</span>
    <span class="kd">var</span> <span class="nx">user</span> <span class="o">=</span> <span class="nx">Parse</span><span class="p">.</span><span class="nx">User</span><span class="p">.</span><span class="nx">current</span><span class="p">();</span>
    <span class="nx">user</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="s2">&quot;phoneVerificationCode&quot;</span><span class="p">,</span> <span class="nx">verificationCode</span><span class="p">);</span>
    <span class="nx">user</span><span class="p">.</span><span class="nx">save</span><span class="p">();</span>
    
    <span class="nx">twilio</span><span class="p">.</span><span class="nx">sendSms</span><span class="p">({</span>
        <span class="nx">From</span><span class="o">:</span> <span class="s2">&quot;&lt;Your Twilio phone number&gt;&quot;</span><span class="p">,</span>
        <span class="nx">To</span><span class="o">:</span> <span class="nx">request</span><span class="p">.</span><span class="nx">params</span><span class="p">.</span><span class="nx">phoneNumber</span><span class="p">,</span>
        <span class="nx">Body</span><span class="o">:</span> <span class="s2">&quot;Your verification code is &quot;</span> <span class="o">+</span> <span class="nx">verificationCode</span> <span class="o">+</span> <span class="s2">&quot;.&quot;</span>
    <span class="p">},</span> <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">responseData</span><span class="p">)</span> <span class="p">{</span> 
        <span class="k">if</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">response</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span> 
          <span class="nx">response</span><span class="p">.</span><span class="nx">success</span><span class="p">(</span><span class="s2">&quot;Success&quot;</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">});</span>
<span class="p">});</span></code></pre></div>

<p>This function accepts the phone number as a parameter, as seen in request.params.phoneNumber. It generates a verification code and stores it in the user&#39;s record. Then, it sends that code to the user via Twilio.</p>

<h2>Verify Phone Number</h2>

<p>The second Cloud Function that we need to define is the one that verifies the user&#39;s phone number and stores it in the database. I will call this function verifyPhoneNumber, and it will take the phone number and the verification code as parameters. It is defined as follows:</p>

<div class="highlight"><pre><code class="js"><span class="nx">Parse</span><span class="p">.</span><span class="nx">Cloud</span><span class="p">.</span><span class="nx">define</span><span class="p">(</span><span class="s2">&quot;verifyPhoneNumber&quot;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">request</span><span class="p">,</span> <span class="nx">response</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">user</span> <span class="o">=</span> <span class="nx">Parse</span><span class="p">.</span><span class="nx">User</span><span class="p">.</span><span class="nx">current</span><span class="p">();</span>
    <span class="kd">var</span> <span class="nx">verificationCode</span> <span class="o">=</span> <span class="nx">user</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s2">&quot;phoneVerificationCode&quot;</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">verificationCode</span> <span class="o">==</span> <span class="nx">request</span><span class="p">.</span><span class="nx">params</span><span class="p">.</span><span class="nx">phoneVerificationCode</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">user</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="s2">&quot;phoneNumber&quot;</span><span class="p">,</span> <span class="nx">request</span><span class="p">.</span><span class="nx">params</span><span class="p">.</span><span class="nx">phoneNumber</span><span class="p">);</span>
        <span class="nx">user</span><span class="p">.</span><span class="nx">save</span><span class="p">();</span>
        <span class="nx">response</span><span class="p">.</span><span class="nx">success</span><span class="p">(</span><span class="s2">&quot;Success&quot;</span><span class="p">);</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="nx">response</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="s2">&quot;Invalid verification code.&quot;</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">});</span></code></pre></div>

<p>As you can see, this function first checks if the verification code that the user sends matches that which was saved in the database. If it is, it sets the user&#39;s phone number to the number that the user included in his request.</p>

<h2>Deploying the Cloud Functions</h2>

<p>At this point, you are done with your server-side logic. Go ahead and save the main.js file. Then, use the command line to go to the root directory of your cloud code. When you are there, run the following command to push your code to Parse:</p>

<div class="highlight"><pre><code class="js"><span class="nx">parse</span> <span class="nx">deploy</span></code></pre></div>

<h2>Next Steps</h2>

<p>Now that your backend is ready to roll, it is time to connect your client-side. With Parse&#39;s SDK, all you need to do is use the Call Cloud Function command. This differs from platform to platform, so refer to the Parse documentation to find the command for calling a Cloud Function from your client app.</p>

<p>Of course, this is not the best solution to verify phone numbers. It has some drawbacks, such as the user using a different phone number in the verification step. This tutorial is meant to demonstrate how Twilio and Parse can be used together. Now, it is time to use your head and come up with a better and more secure solution. Have fun coding.</p>
</div>
  </div>
  

  
  <div class='post'>
    <span class='date'>20 Jul 2014</span>
    <h1><a href='/blog/web/nodejs/express/2014/07/20/ExpressMultipleSites.html'>How to host multiple websites using Express.js</a></h1>
    <div class='body'><p>Hosting multiple websites using NodeJS and Express is made very simple using Express&#39;s <a href="https://github.com/expressjs/vhost">virtual hosts</a>. Using virtual hosts, you do not need to worry about using a reverse proxy to forward your visitors to different ports. Simply, a virtual host is an Express app tied to a domain name. What does that mean in code? Let&#39;s see!</p>

<h2>Our Workspace</h2>

<p>For demonstration, let us assume that we own two domain names: potato.com and tomato.com. We want www.potato.com to direct to the potato website, which is located in a directory named potato, and we want www.tomato.com to direct to the tomato website, which is located in a directory named tomato. For simplicity&#39;s sake, both websites are static websites.</p>

<h2>Creating a Virtual Host</h2>

<p>As I mentioned earlier, a virtual host is an Express app. This is not entirely true. A virtual host wraps up an application into a middleware. After it is wrapped up, we can use it in our main application. The code below shows how to create a virtual host (or vhost).</p>

<div class="highlight"><pre><code class="js"><span class="kd">function</span> <span class="nx">createVirtualHost</span><span class="p">(</span><span class="nx">domainName</span><span class="p">,</span> <span class="nx">dirPath</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">vhost</span> <span class="o">=</span> <span class="nx">express</span><span class="p">();</span>
    <span class="c1">//parses request body and populates request.body</span>
    <span class="nx">vhost</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span> <span class="nx">express</span><span class="p">.</span><span class="nx">bodyParser</span><span class="p">()</span> <span class="p">);</span>
    <span class="c1">//checks request.body for HTTP method overrides</span>
    <span class="nx">vhost</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span> <span class="nx">express</span><span class="p">.</span><span class="nx">methodOverride</span><span class="p">()</span> <span class="p">);</span>
    <span class="c1">//Where to serve static content</span>
    <span class="nx">vhost</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span> <span class="nx">express</span><span class="p">.</span><span class="kr">static</span><span class="p">(</span> <span class="nx">dirPath</span> <span class="p">)</span> <span class="p">);</span>
    <span class="c1">//Show errors</span>
    <span class="nx">vhost</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span> <span class="nx">express</span><span class="p">.</span><span class="nx">errorHandler</span><span class="p">({</span> <span class="nx">dumpExceptions</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span> <span class="nx">showStack</span><span class="o">:</span> <span class="kc">true</span> <span class="p">}));</span>

    <span class="k">return</span> <span class="nx">express</span><span class="p">.</span><span class="nx">vhost</span><span class="p">(</span><span class="nx">domainName</span><span class="p">,</span> <span class="nx">vhost</span><span class="p">)</span>
<span class="p">}</span></code></pre></div>

<p>For our potato and tomato app, we will need to create two virtual hosts as follows:</p>

<div class="highlight"><pre><code class="js"><span class="kd">var</span> <span class="nx">potatoHost</span> <span class="o">=</span> <span class="nx">createVirtualHost</span><span class="p">(</span><span class="s2">&quot;www.potato.com&quot;</span><span class="p">,</span> <span class="s2">&quot;potato&quot;</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">tomatoHost</span> <span class="o">=</span> <span class="nx">createVirtualHost</span><span class="p">(</span><span class="s2">&quot;www.tomato.com&quot;</span><span class="p">,</span> <span class="s2">&quot;tomato&quot;</span><span class="p">);</span></code></pre></div>

<h2>Using the Virtual Hosts</h2>

<p>Using the virtual hosts is as simple as using any piece of middleware. All we have to do is pass them to app.use:</p>

<div class="highlight"><pre><code class="js"><span class="kd">var</span> <span class="nx">app</span> <span class="o">=</span> <span class="nx">express</span><span class="p">();</span>
<span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">potatoHost</span><span class="p">);</span>
<span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">tomatoHost</span><span class="p">);</span></code></pre></div>

<h2>The Full Server Code</h2>

<div class="highlight"><pre><code class="js"><span class="c1">// Module dependencies.</span>
<span class="kd">var</span> <span class="nx">application_root</span> <span class="o">=</span> <span class="nx">__dirname</span><span class="p">,</span>
    <span class="nx">express</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span> <span class="s1">&#39;express&#39;</span> <span class="p">);</span>

<span class="kd">function</span> <span class="nx">createVirtualHost</span><span class="p">(</span><span class="nx">domainName</span><span class="p">,</span> <span class="nx">dirPath</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">vhost</span> <span class="o">=</span> <span class="nx">express</span><span class="p">();</span>
    <span class="c1">//parses request body and populates request.body</span>
    <span class="nx">vhost</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span> <span class="nx">express</span><span class="p">.</span><span class="nx">bodyParser</span><span class="p">()</span> <span class="p">);</span>
    <span class="c1">//checks request.body for HTTP method overrides</span>
    <span class="nx">vhost</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span> <span class="nx">express</span><span class="p">.</span><span class="nx">methodOverride</span><span class="p">()</span> <span class="p">);</span>
    <span class="c1">//Where to serve static content</span>
    <span class="nx">vhost</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span> <span class="nx">express</span><span class="p">.</span><span class="kr">static</span><span class="p">(</span> <span class="nx">dirPath</span> <span class="p">)</span> <span class="p">);</span>
    <span class="c1">//Show errors</span>
    <span class="nx">vhost</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span> <span class="nx">express</span><span class="p">.</span><span class="nx">errorHandler</span><span class="p">({</span> <span class="nx">dumpExceptions</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span> <span class="nx">showStack</span><span class="o">:</span> <span class="kc">true</span> <span class="p">}));</span>

    <span class="k">return</span> <span class="nx">express</span><span class="p">.</span><span class="nx">vhost</span><span class="p">(</span><span class="nx">domainName</span><span class="p">,</span> <span class="nx">vhost</span><span class="p">)</span>
<span class="p">}</span>

<span class="c1">//Create server</span>
<span class="kd">var</span> <span class="nx">app</span> <span class="o">=</span> <span class="nx">express</span><span class="p">();</span>

<span class="c1">//Create the virtual hosts</span>
<span class="kd">var</span> <span class="nx">potatoHost</span> <span class="o">=</span> <span class="nx">createVirtualHost</span><span class="p">(</span><span class="s2">&quot;www.potato.com&quot;</span><span class="p">,</span> <span class="s2">&quot;potato&quot;</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">tomatoHost</span> <span class="o">=</span> <span class="nx">createVirtualHost</span><span class="p">(</span><span class="s2">&quot;www.tomato.com&quot;</span><span class="p">,</span> <span class="s2">&quot;tomato&quot;</span><span class="p">);</span>

<span class="c1">//Use the virtual hosts</span>
<span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">potatoHost</span><span class="p">);</span>
<span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">tomatoHost</span><span class="p">);</span>

<span class="c1">//Start server</span>
<span class="kd">var</span> <span class="nx">port</span> <span class="o">=</span> <span class="mi">80</span><span class="p">;</span>
<span class="nx">app</span><span class="p">.</span><span class="nx">listen</span><span class="p">(</span> <span class="nx">port</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span> <span class="s1">&#39;Express server listening on port %d in %s mode&#39;</span><span class="p">,</span> <span class="nx">port</span><span class="p">,</span> <span class="nx">app</span><span class="p">.</span><span class="nx">settings</span><span class="p">.</span><span class="nx">env</span> <span class="p">);</span>
<span class="p">});</span></code></pre></div>

<h2>Testing the Server</h2>

<p>In order to see the server work, we must own both domain names and set their addresses to that of our server. Since we do not own the domain names and the process is arduous, we will modify the hosts file to make those domain names point to our local machine.</p>

<p>On Windows, the hosts file can be found in c:\windows\system32\drivers\etc</p>

<p>On Mac or Linux, the hosts file can be found in /etc</p>

<p>The hosts file may be hidden on some systems. If you do not see it in the directory, make sure that you enable viewing hidden files from your folder options or control panel.</p>

<p>Open the hosts file, add the following lines of code to the bottom of the file, and save it.</p>

<div class="highlight"><pre><code class="sh">127.0.0.1 www.potato.com
127.0.0.1 www.tomato.com</code></pre></div>

<p>Now, run your NodeJS application and navigate to www.potato.com and www.tomato.com from any browser. Voila! You should now be directed to the potato website and the tomato website respectively. Give yourself a pat on the back and have some chicken alfredo with a potato and a tomato on the side.</p>
</div>
  </div>
  

  
  <div class='post'>
    <span class='date'>26 Jun 2014</span>
    <h1><a href='/blog/web/2014/06/26/NodeRestAPITutorial.html'>How to build a scalable REST API using Node.JS and Express</a></h1>
    <div class='body'><p>When I build an API, I like to have it as light-weight and scalable as possible. At the same time, I want to be able to easily add or remove features with the least amount of effort possible. Because <a href="http://nodejs.org/">Node.JS</a> and <a href="http://expressjs.com/">Express</a> give control over the inner workings of a web application, they are the perfect fit.</p>

<h2>What will we build?</h2>

<p>We will build a RESTful API for a library. A library has books, accounts, DVDs, and many more things. As I always do, I will approach the problem by building an API for books only, and then scaling it to include all the other library items.</p>

<h2>First Rollout: Build a Dumb Server</h2>

<p>Before we start writing code, we need to fetch the dependencies. Even though the only dependency is Express, I like to keep a package.json file in case I ever decide to add other dependencies in the future. So, the first thing we will do is create a file called package.json and put the following code in it:</p>

<div class="highlight"><pre><code class="json"><span class="p">{</span>
    <span class="nt">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;library-rest-api&quot;</span><span class="p">,</span>
    <span class="nt">&quot;version&quot;</span><span class="p">:</span> <span class="s2">&quot;0.0.1&quot;</span><span class="p">,</span>
    <span class="nt">&quot;description&quot;</span><span class="p">:</span> <span class="s2">&quot;A simple library REST api&quot;</span><span class="p">,</span>
    <span class="nt">&quot;dependencies&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="nt">&quot;express&quot;</span><span class="p">:</span> <span class="s2">&quot;~3.1.0&quot;</span>
    <span class="p">}</span>
<span class="p">}</span></code></pre></div>

<p>Now open up your terminal or command line and go to the project&#39;s directory. Type</p>

<div class="highlight"><pre><code class="sh">npm install</code></pre></div>

<p>to install Express. It will be installed in the node_modules directory.</p>

<p>Now that we have all the dependencies ready, let&#39;s create a simple server that will capture requests and respond with a Hello World.</p>

<div class="highlight"><pre><code class="js"><span class="c1">// Module dependencies.</span>
<span class="kd">var</span> <span class="nx">application_root</span> <span class="o">=</span> <span class="nx">__dirname</span><span class="p">,</span>
    <span class="nx">express</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span> <span class="s1">&#39;express&#39;</span> <span class="p">);</span> <span class="c1">//Web framework</span>

<span class="c1">//Create server</span>
<span class="kd">var</span> <span class="nx">app</span> <span class="o">=</span> <span class="nx">express</span><span class="p">();</span>

<span class="c1">// Configure server</span>
<span class="nx">app</span><span class="p">.</span><span class="nx">configure</span><span class="p">(</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="c1">//parses request body and populates request.body</span>
    <span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span> <span class="nx">express</span><span class="p">.</span><span class="nx">bodyParser</span><span class="p">()</span> <span class="p">);</span>

    <span class="c1">//checks request.body for HTTP method overrides</span>
    <span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span> <span class="nx">express</span><span class="p">.</span><span class="nx">methodOverride</span><span class="p">()</span> <span class="p">);</span>

    <span class="c1">//perform route lookup based on url and HTTP method</span>
    <span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span> <span class="nx">app</span><span class="p">.</span><span class="nx">router</span> <span class="p">);</span>

    <span class="c1">//Show all errors in development</span>
    <span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span> <span class="nx">express</span><span class="p">.</span><span class="nx">errorHandler</span><span class="p">({</span> <span class="nx">dumpExceptions</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span> <span class="nx">showStack</span><span class="o">:</span> <span class="kc">true</span> <span class="p">}));</span>
<span class="p">});</span>

<span class="c1">//Router</span>
<span class="c1">//Get a list of all books</span>
<span class="nx">app</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span> <span class="s1">&#39;/api/books&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span> <span class="nx">request</span><span class="p">,</span> <span class="nx">response</span> <span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">books</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">{</span>
                <span class="nx">title</span><span class="o">:</span> <span class="s2">&quot;Book 1&quot;</span><span class="p">,</span>
                <span class="nx">author</span><span class="o">:</span> <span class="s2">&quot;Author 1&quot;</span><span class="p">,</span>
                <span class="nx">releaseDate</span><span class="o">:</span> <span class="s2">&quot;01/01/2014&quot;</span>
            <span class="p">},</span>
            <span class="p">{</span>
                <span class="nx">title</span><span class="o">:</span> <span class="s2">&quot;Book 2&quot;</span><span class="p">,</span>
                <span class="nx">author</span><span class="o">:</span> <span class="s2">&quot;Author 2&quot;</span><span class="p">,</span>
                <span class="nx">releaseDate</span><span class="o">:</span> <span class="s2">&quot;02/02/2014&quot;</span>
            <span class="p">}</span>
        <span class="p">];</span>

    <span class="nx">response</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="nx">books</span><span class="p">);</span>
<span class="p">});</span>
<span class="c1">//Insert a new book</span>
<span class="nx">app</span><span class="p">.</span><span class="nx">post</span><span class="p">(</span> <span class="s1">&#39;/api/books&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span> <span class="nx">request</span><span class="p">,</span> <span class="nx">response</span> <span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">book</span> <span class="o">=</span> <span class="p">{</span>
        <span class="nx">title</span><span class="o">:</span> <span class="nx">request</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">title</span><span class="p">,</span>
        <span class="nx">author</span><span class="o">:</span> <span class="nx">request</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">author</span><span class="p">,</span>
        <span class="nx">releaseDate</span><span class="o">:</span> <span class="nx">request</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">releaseDate</span>
    <span class="p">};</span>
    
    <span class="nx">response</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="nx">book</span><span class="p">);</span>
<span class="p">});</span>
<span class="c1">//Get a single book by id</span>
<span class="nx">app</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span> <span class="s1">&#39;/api/books/:id&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span> <span class="nx">request</span><span class="p">,</span> <span class="nx">response</span> <span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">book</span> <span class="o">=</span> <span class="p">{</span>
        <span class="nx">title</span><span class="o">:</span> <span class="s2">&quot;Unique Book&quot;</span><span class="p">,</span>
        <span class="nx">author</span><span class="o">:</span> <span class="s2">&quot;Unique Author&quot;</span><span class="p">,</span>
        <span class="nx">releaseDate</span><span class="o">:</span> <span class="s2">&quot;03/03/2014&quot;</span>
    <span class="p">};</span>
    
    <span class="nx">response</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="nx">book</span><span class="p">);</span>
<span class="p">});</span>
<span class="c1">//Update a book</span>
<span class="nx">app</span><span class="p">.</span><span class="nx">put</span><span class="p">(</span> <span class="s1">&#39;/api/books/:id&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span> <span class="nx">request</span><span class="p">,</span> <span class="nx">response</span> <span class="p">)</span> <span class="p">{</span>
    <span class="nx">response</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="s2">&quot;Updated!&quot;</span><span class="p">);</span>
<span class="p">});</span>
<span class="c1">//Delete a book</span>
<span class="nx">app</span><span class="p">.</span><span class="k">delete</span><span class="p">(</span> <span class="s1">&#39;/api/books/:id&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span> <span class="nx">request</span><span class="p">,</span> <span class="nx">response</span> <span class="p">)</span> <span class="p">{</span>
    <span class="nx">response</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="s2">&quot;Deleted&quot;</span><span class="p">);</span>
<span class="p">});</span>

<span class="c1">//Start server</span>
<span class="kd">var</span> <span class="nx">port</span> <span class="o">=</span> <span class="mi">4711</span><span class="p">;</span>
<span class="nx">app</span><span class="p">.</span><span class="nx">listen</span><span class="p">(</span> <span class="nx">port</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span> <span class="s1">&#39;Express server listening on port %d in %s mode&#39;</span><span class="p">,</span> <span class="nx">port</span><span class="p">,</span> <span class="nx">app</span><span class="p">.</span><span class="nx">settings</span><span class="p">.</span><span class="nx">env</span> <span class="p">);</span>
<span class="p">});</span></code></pre></div>

<p>Save the file and run</p>

<div class="highlight"><pre><code class="sh">node server.js</code></pre></div>

<p>to start the server. The server should response with the hardcoded data when you try to get a book and should echo back the data when you try to do another operation, such as inserting, deleting, or updating.</p>

<h2>From Dumb to RESTful</h2>

<p>Before we can use real data in our API, we must understand the two fundamental requirements for every API. These two fundamental requirements are communication and storage.</p>

<p>Communication refers to the way in which data is passed back-and-forth between the server and the clients. Since we are building a RESTful API, our communication protocol is <a href="http://en.wikipedia.org/wiki/Hypertext_Transfer_Protocol">HTTP</a>, which we dealt with using Express.</p>

<p>Storage refers to the medium and format in which data is stored. For example, data can be stored on a database server, in a file, or in memory. To fulfill this requirement, I like to start by using MongoDB to store my data. To access the <a href="http://www.mongodb.org/">MongoDB</a> database from Node.JS, we will use an NPM package called <a href="http://mongoosejs.com/">Mongoose</a>.</p>

<h2>Setting up the Database</h2>

<p>Before you start using real data in your API, you need to install MongoDB or use a third-party service like MongoHQ. Please refer to the instructions on the MongoDB website to install MongoDB.</p>

<p>After you install MongoDB, create a database called library_database. Then, add a collection named &quot;books&quot; to the database. Run the database server (mongod), and you should be all set.</p>

<h2>Second Rollout: Use Real Data</h2>

<p>As always, before we start writing any code, we must have all the dependencies ready. The new dependency that we will introduce for this rollout is Mongoose. To install Mongoose, modify your package.json file to look as follows:</p>

<div class="highlight"><pre><code class="json"><span class="p">{</span>
    <span class="nt">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;library-rest-api&quot;</span><span class="p">,</span>
    <span class="nt">&quot;version&quot;</span><span class="p">:</span> <span class="s2">&quot;0.0.1&quot;</span><span class="p">,</span>
    <span class="nt">&quot;description&quot;</span><span class="p">:</span> <span class="s2">&quot;A simple library REST api&quot;</span><span class="p">,</span>
    <span class="nt">&quot;dependencies&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="nt">&quot;express&quot;</span><span class="p">:</span> <span class="s2">&quot;~3.1.0&quot;</span><span class="p">,</span>
        <span class="nt">&quot;mongoose&quot;</span><span class="p">:</span> <span class="s2">&quot;~3.5.5&quot;</span>
    <span class="p">}</span>
<span class="p">}</span></code></pre></div>

<p>and run</p>

<div class="highlight"><pre><code class="sh">npm install</code></pre></div>

<p>To use Mongoose from our Node.js application, we first need to require it. Change the module dependencies code block to</p>

<div class="highlight"><pre><code class="js"><span class="c1">// Module dependencies.</span>
<span class="kd">var</span> <span class="nx">application_root</span> <span class="o">=</span> <span class="nx">__dirname</span><span class="p">,</span>
    <span class="nx">express</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span> <span class="s1">&#39;express&#39;</span> <span class="p">),</span>     <span class="c1">//Web framework</span>
    <span class="nx">path</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span> <span class="s1">&#39;path&#39;</span> <span class="p">),</span>           <span class="c1">//Utilities for dealing with file paths</span>
    <span class="nx">mongoose</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span> <span class="s1">&#39;mongoose&#39;</span> <span class="p">);</span>   <span class="c1">//Used for accessing a MongoDB database</span></code></pre></div>

<p>Then, we need to connect Mongoose to our database. We use the connect method to connect it to our local (or remote) database. Note that the url points to the database inside MongoDB (in this case it is library_database).</p>

<div class="highlight"><pre><code class="js"><span class="c1">//Connect to database</span>
<span class="nx">mongoose</span><span class="p">.</span><span class="nx">connect</span><span class="p">(</span> <span class="s1">&#39;mongodb://localhost/library_database&#39;</span> <span class="p">);</span></code></pre></div>

<p>Mongoose provides two neat classes for dealing with data: Schema and model. Schema is used for data validation, and Model is used to send and receive data from the database. We will now create a Schema and a Model that adhere to our original data model.</p>

<div class="highlight"><pre><code class="js"><span class="c1">//Schema</span>
<span class="kd">var</span> <span class="nx">BookSchema</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">mongoose</span><span class="p">.</span><span class="nx">Schema</span><span class="p">({</span>
    <span class="nx">title</span><span class="o">:</span> <span class="nb">String</span><span class="p">,</span>
    <span class="nx">author</span><span class="o">:</span> <span class="nb">String</span><span class="p">,</span>
    <span class="nx">releaseDate</span><span class="o">:</span> <span class="nb">Date</span>
<span class="p">});</span>
<span class="c1">//Model</span>
<span class="kd">var</span> <span class="nx">BookModel</span> <span class="o">=</span> <span class="nx">mongoose</span><span class="p">.</span><span class="nx">model</span><span class="p">(</span> <span class="s1">&#39;Book&#39;</span><span class="p">,</span> <span class="nx">BookSchema</span> <span class="p">);</span></code></pre></div>

<p>Now we have everything ready to start responding to API requests. Since all of the request/response processing happens in the router, we will only change the router code it account for the persistent data. The new router should look as follows:</p>

<div class="highlight"><pre><code class="js"><span class="c1">//Router</span>
<span class="c1">//Get a list of all books</span>
<span class="nx">app</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span> <span class="s1">&#39;/api/books&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span> <span class="nx">request</span><span class="p">,</span> <span class="nx">response</span> <span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">BookModel</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span> <span class="nx">err</span><span class="p">,</span> <span class="nx">books</span> <span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span><span class="p">(</span> <span class="o">!</span><span class="nx">err</span> <span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="nx">response</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span> <span class="nx">books</span> <span class="p">);</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span> <span class="nx">err</span> <span class="p">);</span>
            <span class="k">return</span> <span class="nx">response</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="s1">&#39;ERROR&#39;</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">});</span>
<span class="p">});</span>
<span class="c1">//Insert a new book</span>
<span class="nx">app</span><span class="p">.</span><span class="nx">post</span><span class="p">(</span> <span class="s1">&#39;/api/books&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span> <span class="nx">request</span><span class="p">,</span> <span class="nx">response</span> <span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">book</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">BookModel</span><span class="p">({</span>
        <span class="nx">title</span><span class="o">:</span> <span class="nx">request</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">title</span><span class="p">,</span>
        <span class="nx">author</span><span class="o">:</span> <span class="nx">request</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">author</span><span class="p">,</span>
        <span class="nx">releaseDate</span><span class="o">:</span> <span class="nx">request</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">releaseDate</span>
    <span class="p">});</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">request</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">title</span><span class="p">);</span>
    <span class="nx">book</span><span class="p">.</span><span class="nx">save</span><span class="p">(</span> <span class="kd">function</span><span class="p">(</span> <span class="nx">err</span> <span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span><span class="p">(</span> <span class="o">!</span><span class="nx">err</span> <span class="p">)</span> <span class="p">{</span>
            <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span> <span class="s1">&#39;created&#39;</span> <span class="p">);</span>
            <span class="k">return</span> <span class="nx">response</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span> <span class="nx">book</span> <span class="p">);</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span> <span class="nx">err</span> <span class="p">);</span>
            <span class="k">return</span> <span class="nx">response</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="s1">&#39;ERROR&#39;</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">});</span>
<span class="p">});</span>
<span class="c1">//Get a single book by id</span>
<span class="nx">app</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span> <span class="s1">&#39;/api/books/:id&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span> <span class="nx">request</span><span class="p">,</span> <span class="nx">response</span> <span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">BookModel</span><span class="p">.</span><span class="nx">findById</span><span class="p">(</span> <span class="nx">request</span><span class="p">.</span><span class="nx">params</span><span class="p">.</span><span class="nx">id</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span> <span class="nx">err</span><span class="p">,</span> <span class="nx">book</span> <span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span><span class="p">(</span> <span class="o">!</span><span class="nx">err</span> <span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="nx">response</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span> <span class="nx">book</span> <span class="p">);</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span> <span class="nx">err</span> <span class="p">);</span>
            <span class="k">return</span> <span class="nx">response</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="s1">&#39;ERROR&#39;</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">});</span>
<span class="p">});</span>
<span class="c1">//Update a book</span>
<span class="nx">app</span><span class="p">.</span><span class="nx">put</span><span class="p">(</span> <span class="s1">&#39;/api/books/:id&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span> <span class="nx">request</span><span class="p">,</span> <span class="nx">response</span> <span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">BookModel</span><span class="p">.</span><span class="nx">findById</span><span class="p">(</span> <span class="nx">request</span><span class="p">.</span><span class="nx">params</span><span class="p">.</span><span class="nx">id</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span> <span class="nx">err</span><span class="p">,</span> <span class="nx">book</span> <span class="p">)</span> <span class="p">{</span>
        <span class="nx">book</span><span class="p">.</span><span class="nx">title</span> <span class="o">=</span> <span class="nx">request</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">title</span><span class="p">;</span>
        <span class="nx">book</span><span class="p">.</span><span class="nx">author</span> <span class="o">=</span> <span class="nx">request</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">author</span><span class="p">;</span>
        <span class="nx">book</span><span class="p">.</span><span class="nx">releaseDate</span> <span class="o">=</span> <span class="nx">request</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">releaseDate</span><span class="p">;</span>

        <span class="k">return</span> <span class="nx">book</span><span class="p">.</span><span class="nx">save</span><span class="p">(</span> <span class="kd">function</span><span class="p">(</span> <span class="nx">err</span> <span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span><span class="p">(</span> <span class="o">!</span><span class="nx">err</span> <span class="p">)</span> <span class="p">{</span>
                <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span> <span class="s1">&#39;book updated&#39;</span> <span class="p">);</span>
                <span class="k">return</span> <span class="nx">response</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span> <span class="nx">book</span> <span class="p">);</span>
            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span> <span class="nx">err</span> <span class="p">);</span>
                <span class="k">return</span> <span class="nx">response</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="s1">&#39;ERROR&#39;</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">});</span>
    <span class="p">});</span>
<span class="p">});</span>
<span class="c1">//Delete a book</span>
<span class="nx">app</span><span class="p">.</span><span class="k">delete</span><span class="p">(</span> <span class="s1">&#39;/api/books/:id&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span> <span class="nx">request</span><span class="p">,</span> <span class="nx">response</span> <span class="p">)</span> <span class="p">{</span>
    <span class="nx">BookModel</span><span class="p">.</span><span class="nx">findById</span><span class="p">(</span> <span class="nx">request</span><span class="p">.</span><span class="nx">params</span><span class="p">.</span><span class="nx">id</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span> <span class="nx">err</span><span class="p">,</span> <span class="nx">book</span> <span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">book</span><span class="p">.</span><span class="nx">remove</span><span class="p">(</span> <span class="kd">function</span><span class="p">(</span> <span class="nx">err</span> <span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span><span class="p">(</span> <span class="o">!</span><span class="nx">err</span> <span class="p">)</span> <span class="p">{</span>
                <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span> <span class="s1">&#39;Book removed&#39;</span> <span class="p">);</span>
                <span class="k">return</span> <span class="nx">response</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span> <span class="s1">&#39;&#39;</span> <span class="p">);</span>
            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span> <span class="nx">err</span> <span class="p">);</span>
                <span class="k">return</span> <span class="nx">response</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="s1">&#39;ERROR&#39;</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">});</span>
    <span class="p">});</span>
<span class="p">});</span></code></pre></div>

<p>Here we go, our REST API is now ready to roll.</p>

<h2>Evident Patterns</h2>

<p>As we were building our RESTful API, some interesting patterns emerged. For example, the router code block can be swapped with another router code block to add new functionality. In this case, it makes more sense to enclose our routing logic in a separate file. As our code grows, we will also have more schemas, models, and logic to worry about. All of these will eventually need to move out of the server file.</p>

<h2>Refactor Code</h2>

<p>There are hundreds of ways to improve our code. For demonstration, we will move the routing logic out of the server.js.</p>

<p>First, create a new file called router.js. In that file, create a function named registerRoutes that takes in the Express app and Mongoose as parameters. Then, move all the routing logic from server.js to the newly created function. The contents of router.js will be something like this:</p>

<div class="highlight"><pre><code class="js"><span class="kd">function</span> <span class="nx">registerRoutes</span><span class="p">(</span><span class="nx">app</span><span class="p">,</span> <span class="nx">mongoose</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">//Router</span>
    <span class="c1">//Get a list of all books</span>
    <span class="nx">app</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span> <span class="s1">&#39;/api/books&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span> <span class="nx">request</span><span class="p">,</span> <span class="nx">response</span> <span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">BookModel</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span> <span class="nx">err</span><span class="p">,</span> <span class="nx">books</span> <span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span><span class="p">(</span> <span class="o">!</span><span class="nx">err</span> <span class="p">)</span> <span class="p">{</span>
                <span class="k">return</span> <span class="nx">response</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span> <span class="nx">books</span> <span class="p">);</span>
            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span> <span class="nx">err</span> <span class="p">);</span>
                <span class="k">return</span> <span class="nx">response</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="s1">&#39;ERROR&#39;</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">});</span>
    <span class="p">});</span>
    
    <span class="c1">//...</span>

    <span class="c1">//Delete a book</span>
    <span class="nx">app</span><span class="p">.</span><span class="k">delete</span><span class="p">(</span> <span class="s1">&#39;/api/books/:id&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span> <span class="nx">request</span><span class="p">,</span> <span class="nx">response</span> <span class="p">)</span> <span class="p">{</span>
        <span class="nx">BookModel</span><span class="p">.</span><span class="nx">findById</span><span class="p">(</span> <span class="nx">request</span><span class="p">.</span><span class="nx">params</span><span class="p">.</span><span class="nx">id</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span> <span class="nx">err</span><span class="p">,</span> <span class="nx">book</span> <span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="nx">book</span><span class="p">.</span><span class="nx">remove</span><span class="p">(</span> <span class="kd">function</span><span class="p">(</span> <span class="nx">err</span> <span class="p">)</span> <span class="p">{</span>
                <span class="k">if</span><span class="p">(</span> <span class="o">!</span><span class="nx">err</span> <span class="p">)</span> <span class="p">{</span>
                    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span> <span class="s1">&#39;Book removed&#39;</span> <span class="p">);</span>
                    <span class="k">return</span> <span class="nx">response</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span> <span class="s1">&#39;&#39;</span> <span class="p">);</span>
                <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span> <span class="nx">err</span> <span class="p">);</span>
                    <span class="k">return</span> <span class="nx">response</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="s1">&#39;ERROR&#39;</span><span class="p">);</span>
                <span class="p">}</span>
            <span class="p">});</span>
        <span class="p">});</span>
    <span class="p">});</span>
<span class="p">}</span></code></pre></div>

<p>The last step is to register the routes from server.js. All you have to do is require your router and call the registerRoutes method in place of your old router.</p>

<h2>Next Steps</h2>

<p>Congratulations! You did it. You built a RESTful API. However, having the API is only one step of the journey. The more important lesson that you need to learn is to take your journey one step at a time. First, create a dumb app. Then, make it smarter. Then, refactor. The cycle goes on and on. The moral of this lesson is that refactoring is a crucial step in software development. Just like you cannot build a skyscraper with a shaky fundamental, you cannot build web applications with bad code. Farewell and good luck on your journey.</p>
</div>
  </div>
  

  
  <div class='post'>
    <span class='date'>28 May 2014</span>
    <h1><a href='/blog/life/2014/05/28/InterningAtBrainJocks.html'>My Internship at BrainJocks</a></h1>
    <div class='body'><p>On January 2nd of this year, I had the pleasure of being accepted for an internship at <a href="http://www.brainjocks.com">BrainJocks</a>. BrainJocks is a small company of around 25 dedicated employees who work hard to build beautiful websites for enterprises. The Content Management System that we use is <a href="http://www.sitecore.net">Sitecore</a>, but I did not have the chance to use it yet. For applications, the company uses whatever best solves the problem.</p>

<p>In the projects that I work on, I use ASP.NET MVC to build an application hosted on the Azure Cloud. The best quality that I find in BrainJocks is the freedom it gives its interns. I, as an intern, not only get to learn the cutting-edge tools used in the industry, but I also get the chance to apply them into the company&#39;s projects. For instance, one of the tools that I introduced to the company is Azure Media Services, which handles video processing and streaming to large-scale applications. Even though this can be tedious, it is extremely rewarding to see the team approve my plans and add it into our workflow.</p>

<p>I built a simple impress.js presentation about my experience as an Intern. Check the <a href="http://shamadeh.com/co-op-presentation/index.html">presentation</a> now and apply immediately if you get a positive impression.</p>
</div>
  </div>
  

  
  <div class='post'>
    <span class='date'>06 Apr 2014</span>
    <h1><a href='/blog/web/2014/04/06/Unvalidated-Redirects.html'>Web Security: Unvalidated Redirects</a></h1>
    <div class='body'><p>Did you expect to be on Google or some other page but found yourself here? Then, let me tell you that you were a victim to one of the top 10 web security threats: <a href="https://www.owasp.org/index.php/Top_10_2010-A10-Unvalidated_Redirects_and_Forwards">Unvalidated Redirects</a>. Do not worry, you are in safe hands (this blog).</p>

<h2>What Happened?</h2>

<p>The link that you clicked is probably a redirection link, such as those found in Google&#39;s search results. Companies like Google and Twitter use redirection links to track where their users are going. It helps them gather information and hide information. For example, using redirection URLs, websites can:</p>

<ul>
<li>  Track where their userbase is going.</li>
<li>  Hide referral information (search query strings, etc...) from the websites that the users are redirected to.</li>
</ul>

<h2>Why is this a Threat?</h2>

<p>Most users who surf the web do not look at their address bar on every page they visit. To most of them, seeing that a link starts with www.google.com is enough to make the link trustworthy. Now if a malicious user creates a website that clones Google&#39;s login page and sends a redirection URL that starts with www.google.com, the victims are only 1 step close to sending out their password.</p>

<p>Other users may use this security weakness to get more traffic. If the &quot;bad&quot; users serve ads, they make more money.</p>

<h2>What Defenses can Web Developers Take to Keep their Websites Safe?</h2>

<p>The easiest way to keep your sites safe is to stay away from redirection using query string parameters. If this is not something that you can easily do, here are some strategies that you can use:</p>

<ul>
<li>  Keep a hash map of URLs. In other words, instead of having the URL in the query string, have a key that refers to that URL there. In this way, only the URLs for the keys that YOU define are redirectable.</li>
<li>  A better method is to have a domain name dedicated to URL redirections. <a href="https://twitter.com/">Twitter</a> uses <a href="https://support.twitter.com//entries/109623">t.co</a> to track its users&#39; whereabouts while explicitly showing them that they will be redirected. <a href="https://www.yahoo.com/">Yahoo</a> uses r.search.yahoo.com for the same purpose.</li>
</ul>

<h2>What Defenses can Users Take to Stay Safe?</h2>

<p>Look at the full URL before visiting a link. The first part of it does not tell you everything. For some URLs, this practice can be tedious. In that case, look at the URL every time you are about to submit a form or enter sensitive information.</p>
</div>
  </div>
  

  
    
    <h3>Older Posts</h3>
    <table class='post-list'>
    
    <tr>
      <th><a href='/blog/programming/2014/03/16/AssessYourCollaborativeProgramming.html'>Assess your Collaborative Programming Skills</a></th>
      <td>16 Mar 2014</td>
    </tr>
  

  
    
    <tr>
      <th><a href='/blog/web/2014/02/24/WebPerformanceTrends.html'>Web Performance Trends: One Load, That's All</a></th>
      <td>24 Feb 2014</td>
    </tr>
  

  
    
    <tr>
      <th><a href='/blog/opinion/2014/02/09/WhyYouShouldHaveACloudVM.html'>Why You should have a Virtual Machine in the Cloud</a></th>
      <td>09 Feb 2014</td>
    </tr>
  

  
    
    <tr>
      <th><a href='/blog/opinion/2014/01/12/CompScieOrSoftEngineer.html'>Computer Science VS Software Engineering</a></th>
      <td>12 Jan 2014</td>
    </tr>
  

  
    
    <tr>
      <th><a href='/blog/web/2013/12/28/MakeABlogSocial.html'>Make a Blog Social (Without a Database)</a></th>
      <td>28 Dec 2013</td>
    </tr>
  

  
    
    <tr>
      <th><a href='/blog/sci-fi/2013/12/26/WhatIfCarsHadAPIs.html'>What if Cars had APIs</a></th>
      <td>26 Dec 2013</td>
    </tr>
  

  
    
    <tr>
      <th><a href='/blog/blogging/2013/12/24/MovingToJekyll.html'>Moving the Blog to Jekyll</a></th>
      <td>24 Dec 2013</td>
    </tr>
  

  
    
    <tr>
      <th><a href='/blog/android/2012/09/10/KSUBarbecue.html'>Kennesaw State University Student Barbecue</a></th>
      <td>10 Sep 2012</td>
    </tr>
  

  
    
    <tr>
      <th><a href='/blog/android/2012/05/14/DiclopediaOneMonth.html'>Diclopedia is 1 Month Old</a></th>
      <td>14 May 2012</td>
    </tr>
  

  
    
    <tr>
      <th><a href='/blog/android/2012/04/20/DiclopediaStatistics.html'>Diclopedia Statistics: First Week</a></th>
      <td>20 Apr 2012</td>
    </tr>
  

  
    
    <tr>
      <th><a href='/blog/android/2012/04/13/Diclopedia.html'>Beginning Android App Development</a></th>
      <td>13 Apr 2012</td>
    </tr>
  

  
    
    <tr>
      <th><a href='/blog/android/2012/03/21/BeginningAppDev.html'>Beginning Android App Development</a></th>
      <td>21 Mar 2012</td>
    </tr>
  

</table>
            </div>
            
              <div class="col-md-3">
                <!-- Begin MailChimp Signup Form -->
<div id="mc_embed_signup">
	<form action="http://shamadeh.us3.list-manage1.com/subscribe/post?u=35a9df285ba128b01ee2552f6&amp;id=b98478fb0b" method="post" id="mc-embedded-subscribe-form" name="mc-embedded-subscribe-form" class="validate" target="_blank" novalidate>
		<h2>Subscribe</h2>
	<div class="mc-field-group">
		<label for="mce-NAME">Full Name </label>
		<input type="text" value="" name="NAME" class="required" id="mce-NAME">
	</div>
	<div class="mc-field-group">
		<label for="mce-EMAIL">Email Address </label>
		<input type="email" value="" name="EMAIL" class="required email" id="mce-EMAIL">
	</div>
		<div id="mce-responses" class="clear">
			<div class="response" id="mce-error-response" style="display:none"></div>
			<div class="response" id="mce-success-response" style="display:none"></div>
		</div>    <!-- real people should not fill this in and expect good things - do not remove this or risk form bot signups-->
	    <div style="position: absolute; left: -5000px;"><input type="text" name="b_35a9df285ba128b01ee2552f6_b98478fb0b" value=""></div>
		<div class="clear"><input type="submit" style="background-color: #336699" value="Subscribe" name="subscribe" id="mc-embedded-subscribe" class="button"></div>
	</form>
</div>
<!--End mc_embed_signup-->
              </div>
            
          </div>
          
        </div>

        <div id="footer">
  <div class="container">
    <p class="text-center">Proudly hosted by Github Pages</p>
  </div>
</div>

        <script src="/bootstrap/js/bootstrap.min.js"></script>

        
          <!-- Mailchimp -->
          <script src="/js/mailchimp.js"></script>
        

        <script type="text/javascript">
          var _gaq = _gaq || [];
          _gaq.push(['_setAccount', 'UA-46641204-1']);
          _gaq.push(['_trackPageview']);

          (function() {
            var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
            ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
            var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
          })();
        </script>
      </div>
    </body>
</html>
